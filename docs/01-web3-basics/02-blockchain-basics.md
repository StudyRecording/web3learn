# 1.2 区块链基础

## 什么是区块链

区块链是一种**分布式账本技术**，核心特点是：

- **去中心化**：没有中心化的服务器或管理者
- **不可篡改**：一旦写入，无法修改
- **透明公开**：所有交易对所有人可见
- **共识机制**：通过网络共识达成一致

## 区块链的工作原理

### 传统数据库 vs 区块链

```
传统数据库架构
┌─────────────────┐
│   客户端 A      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   中心服务器    │ ◄── 单点故障，可被控制
│   + 数据库      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   客户端 B      │
└─────────────────┘


区块链架构
┌──────────┐     ┌──────────┐     ┌──────────┐
│  节点 A   │────│  节点 B   │────│  节点 C   │
│ (完整账本)│     │ (完整账本)│     │ (完整账本)│
└────┬─────┘     └────┬─────┘     └────┬─────┘
     │                │                │
     └────────────────┴────────────────┘
                      │
              所有节点数据同步
```

### 区块的结构

```
区块结构
┌─────────────────────────────────────────┐
│              区块头 (Block Header)        │
├─────────────────────────────────────────┤
│ 区块号: 12345                            │
│ 时间戳: 2024-01-01 10:00:00             │
│ 前一区块哈希: 0xabc123...                │
│ 当前区块哈希: 0xdef456...                │
│ 默克尔根: 0x789xyz...                    │
│ 难度/Nonce: ...                          │
├─────────────────────────────────────────┤
│              交易列表 (Transactions)      │
├─────────────────────────────────────────┤
│ 交易1: Alice → Bob, 1 ETH               │
│ 交易2: Bob → Carol, 0.5 ETH             │
│ 交易3: ...                               │
└─────────────────────────────────────────┘
```

### 区块链的形成过程

```
交易生命周期

1. 发起交易
   ┌──────────┐
   │ Alice 发起│
   │ 转账请求  │
   └─────┬────┘
         │
         ▼
2. 广播交易
   ┌──────────────────────────────────┐
   │ 交易广播到整个网络                │
   │ 所有节点收到交易                  │
   └─────┬────────────────────────────┘
         │
         ▼
3. 验证交易
   ┌──────────────────────────────────┐
   │ 节点验证:                         │
   │ - 签名是否有效                    │
   │ - 余额是否充足                    │
   │ - 格式是否正确                    │
   └─────┬────────────────────────────┘
         │
         ▼
4. 打包进区块
   ┌──────────────────────────────────┐
   │ 矿工/验证者将交易打包成区块        │
   └─────┬────────────────────────────┘
         │
         ▼
5. 达成共识
   ┌──────────────────────────────────┐
   │ 网络节点对新区块达成共识          │
   │ (PoW/PoS)                        │
   └─────┬────────────────────────────┘
         │
         ▼
6. 区块上链
   ┌──────────────────────────────────┐
   │ 区块被添加到区块链                │
   │ 所有节点更新账本                  │
   │ 交易完成                          │
   └──────────────────────────────────┘
```

## 核心概念详解

### 1. 哈希函数

哈希函数是区块链的基础密码学工具：

```javascript
// 哈希函数特性示例

// 输入任意长度，输出固定长度
hash("Hello")           // 0x185f8db32...
hash("Hello World!!!")  // 0x0b9a3a5d...

// 微小变化，结果完全不同
hash("Hello")           // 0x185f8db32...
hash("Hello!")          // 0x9b71d224b... (完全不同)

// 单向性：无法从哈希反推原始数据
// 确定性：相同输入永远产生相同输出
```

### 2. 公钥密码学

```
公钥密码学 (非对称加密)

┌─────────────────────────────────────────────────┐
│                                                 │
│   私钥 (Private Key)                            │
│   ├── 只有你自己知道                            │
│   ├── 用于签名交易                              │
│   └── 丢失 = 丢失资产                           │
│                                                 │
│   公钥 (Public Key)                             │
│   ├── 可以公开分享                              │
│   ├── 用于验证签名                              │
│   └── 由私钥推导而来                            │
│                                                 │
│   地址 (Address)                                │
│   ├── 公钥的哈希衍生                            │
│   ├── 用于接收资产                              │
│   └── 示例: 0x742d35Cc6634C0532925a3b844Bc9e759│
│                                                 │
└─────────────────────────────────────────────────┘

关系：
私钥 ──推导──> 公钥 ──哈希──> 地址
  │                          │
  └── 签名交易 ──验证──> 公钥验证
```

### 3. 数字签名

```
交易签名过程

1. 构造交易数据
   ┌──────────────────────────────────┐
   │ {                                │
   │   from: "0xalice...",            │
   │   to: "0xbob...",                │
   │   value: "1 ETH",                │
   │   nonce: 123                     │
   │ }                                │
   └──────────────────────────────────┘
              │
              ▼
2. 用私钥签名
   ┌──────────────────────────────────┐
   │ signature = sign(transaction,    │
   │                  privateKey)     │
   │ // 0x1a2b3c...                   │
   └──────────────────────────────────┘
              │
              ▼
3. 广播交易 + 签名
   ┌──────────────────────────────────┐
   │ 节点收到后验证:                   │
   │ 1. 用公钥解密签名                 │
   │ 2. 对比交易数据                   │
   │ 3. 验证确实是私钥持有者发送        │
   └──────────────────────────────────┘
```

### 4. 共识机制

共识机制解决：**谁有权添加新区块？**

#### 工作量证明 (PoW - Proof of Work)

```
PoW 工作流程

1. 矿工收集待确认交易
2. 构造区块头
3. 不断尝试不同 Nonce 值
4. 计算区块哈希
5. 直到哈希满足难度要求

┌─────────────────────────────────────────┐
│ 示例：难度要求哈希以 5 个零开头          │
│                                         │
│ Nonce=0: hash = 0x8f3a1b... ✗          │
│ Nonce=1: hash = 0x2c7d9e... ✗          │
│ Nonce=2: hash = 0xf4e8c2... ✗          │
│ ...                                     │
│ Nonce=12345678: hash = 0x00000a7f... ✓ │
│                                         │
│ 找到！矿工获得记账权和奖励               │
└─────────────────────────────────────────┘

特点：
- 需要大量算力
- 能源消耗大
- 安全性高
- 比特币使用
```

#### 权益证明 (PoS - Proof of Stake)

```
PoS 工作流程

1. 验证者质押代币成为候选
2. 根据质押数量和时间选择验证者
3. 被选中的验证者创建新区块
4. 其他验证者验证并确认

┌─────────────────────────────────────────┐
│ 验证者选择概率                          │
│                                         │
│ Alice: 质押 100 ETH → 10% 概率被选中    │
│ Bob:   质押 300 ETH → 30% 概率被选中    │
│ Carol: 质押 600 ETH → 60% 概率被选中    │
│                                         │
│ 作恶惩罚：质押的 ETH 会被罚没           │
└─────────────────────────────────────────┘

特点：
- 能源效率高
- 更易扩展
- 以太坊 2.0 使用
```

### 5. 默克尔树

```
默克尔树 (Merkle Tree)

                    根哈希 (Merkle Root)
                   /                    \
           Hash AB                      Hash CD
          /      \                      /      \
      Hash A   Hash B              Hash C   Hash D
        │        │                    │        │
     交易A    交易B                交易C    交易D

用途：
1. 高效验证交易是否存在
2. 只需验证一条路径，而非全部交易
3. 轻节点可以只下载区块头

验证交易 B 是否在区块中：
只需提供：交易B + Hash A + Hash CD + 根哈希
计算路径验证即可
```

## 区块链类型

### 1. 公链 (Public Blockchain)

```
特点：
├── 任何人都能参与
├── 完全去中心化
├── 透明公开
└── 需要共识机制

代表：
├── Bitcoin (比特币)
├── Ethereum (以太坊)
├── Solana
└── Polygon
```

### 2. 联盟链 (Consortium Blockchain)

```
特点：
├── 预先选定的节点参与
├── 半去中心化
├── 部分透明
└── 效率较高

代表：
├── Hyperledger Fabric
└── 蚂蚁链 (联盟链版本)
```

### 3. 私有链 (Private Blockchain)

```
特点：
├── 单一组织控制
├── 中心化
├── 权限控制
└── 高效率

用途：
├── 企业内部审计
└── 供应链追踪
```

## 区块链不可能三角

```
        去中心化
            △
           /│\
          / │ \
         /  │  \
        /   │   \
       /    │    \
      ┌─────┼─────┐
      │     │     │
   安全性 ───┼─── 可扩展性
      │     │     │
      └─────┴─────┘

不可能同时完美满足三个属性

比特币/以太坊：牺牲可扩展性，追求去中心化和安全
Solana：牺牲去中心化，追求可扩展性和安全
BSC：牺牲去中心化，追求可扩展性

以太坊的解决方案：
Layer 2 (Rollups) 在保持去中心化和安全的同时提升可扩展性
```

## 区块链浏览器的使用

区块链浏览器是查看链上数据的工具：

- **Etherscan**: https://etherscan.io (以太坊主网)
- **Polygonscan**: https://polygonscan.com (Polygon)

### 查看内容

```
区块浏览器可以查看：

1. 地址信息
   ├── 余额
   ├── 交易历史
   ├── 代币持仓
   └── NFT 持有

2. 交易详情
   ├── 发送方/接收方
   ├── 转账金额
   ├── Gas 费用
   ├── 交易状态
   └── 时间戳

3. 区块信息
   ├── 区块高度
   ├── 交易数量
   ├── 矿工/验证者
   └── 区块奖励

4. 智能合约
   ├── 合约代码
   ├── 合约状态
   └── 事件日志
```

## 动手实践

### 使用 Remix 查看区块

1. 打开 [Remix](https://remix.ethereum.org)
2. 连接 MetaMask 钱包
3. 切换到测试网 (Sepolia)
4. 部署简单合约，观察区块变化

### 练习题

1. 在 Etherscan 上查看一个区块，了解其包含的信息
2. 对比 PoW 和 PoS 的优缺点
3. 为什么区块链数据不可篡改？

## 下一步

[下一节：Web3 核心概念 →](03-core-concepts.md)
